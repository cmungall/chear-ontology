@prefix rdf:           <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:          <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:           <http://www.w3.org/2001/XMLSchema#> .
@prefix owl:           <http://www.w3.org/2002/07/owl#> .
@prefix skos:          <http://www.w3.org/2004/02/skos/core#> .
@prefix prov:          <http://www.w3.org/ns/prov#> .
@prefix sio:           <http://semanticscience.org/resource/> .
@prefix dcat:          <http://www.w3.org/ns/dcat#> .
@prefix dcterms:       <http://purl.org/dc/terms/> .
@prefix void:          <http://rdfs.org/ns/void#> .
@prefix foaf:          <http://xmlns.com/foaf/0.1/> .
@prefix ov:            <http://open.vocab.org/terms/> .
@prefix setl:          <http://purl.org/twc/vocab/setl/> .
@prefix csvw:          <http://www.w3.org/ns/csvw#> .
@prefix pv:            <http://purl.org/net/provenance/ns#>.
@prefix labkey:        <http://chear.tw.rpi.edu/labkey/query/CHEAR%20Production/selectRows.api?schemaName=lists&query.queryName=>.

@prefix :              <https://hadatac.org/setl/> .

@prefix chear:    <http://hadatac.org/ont/chear#> .

:localObjectType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalObjectType;
  ].

:localAnalytes a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalAnalytes;
  ].

:localAttributeType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalAttributeType;
  ].


:LocalInstrumentType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalInstrumentType;
  ].

:LocalDetectorType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalDetectorType;
  ].

:LocalMethodType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalMethodType;
  ].

:LocalPlatformType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalPlatformType;
  ].
  
:LocalProcessType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalProcessType;
  ].
  
:LocalSampleType a setl:JSON;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used labkey:LocalSampleType;
  ].

:base_graph a void:Dataset;
  prov:wasGeneratedBy [
    a setl:Extract;
    prov:used <chear.d/base.ttl>;
  ].

<http://hadatac.org/ont/chear> a void:Dataset;
  prov:wasGeneratedBy [
    a setl:Transform, setl:JSLDT;
    prov:used :localObjectType,
              :localAnalytes,
              :localAttributeType,
              :LocalInstrumentType,
              :LocalDetectorType,
              :LocalMethodType,
              :LocalPlatformType,
              :LocalProcessType,
              :LocalSampleType;
    setl:hasContext '''{
  "@vocab" :  "https://hbgd.tw.rpi.edu/",
  "owl": "http://www.w3.org/2002/07/owl#",
  "rdfs": "http://www.w3.org/2000/01/rdf-schema#",
  "sio" :     "http://semanticscience.org/resource/",
  "chear" :   "http://hadatac.org/ont/chear#",
  "skos" :    "http://www.w3.org/2004/02/skos/core#",
  "prov" :    "http://www.w3.org/ns/prov#",
  "chebi" :   "http://purl.obolibrary.org/obo/CHEBI_",
  "obo" :   "http://purl.obolibrary.org/obo/",
  "pubchem" : "http://rdf.ncbi.nlm.nih.gov/pubchem/compound/",
  "dc"   :    "http://purl.org/dc/terms/",
  "hasco" : "http://hadatac.org/ont/hasco#",
  "vstoi" : "http://hadatac.org/ont/vstoi#",
  "hasneto" : "http://hadatac.org/ont/hasneto#",
  "cmo"  :    "http://purl.org/twc/ontologies/cmo.owl#"
}''';
  prov:value '''[{
    "@id": "http://hadatac.org/ont/chear",
    "@graph": [{
      "@for": "r in row['rows']",
      "@do": {
        "@id": "{{r['hasURI']}}",
        "@type": "owl:Class",
        "rdfs:label": {
          "@if" : "'rdfs:label' in r and r['rdfs:label'] is not None and len(r['rdfs:label'].strip()) > 0",
          "@value" : "{{r['rdfs:label']}}"
        },
        "dc:identifier": {
          "@if" : "'dcterms:identifier' in r and r['dcterms:identifier'] is not None and len(r['dcterms:identifier'].strip()) > 0",
          "@value" : "{{r['dcterms:identifier'].strip()}}"
        },
        "skos:editorialNote": {
          "@if" : "'skos:editorialNote' in r and r['skos:editorialNote'] is not None and len(r['skos:editorialNote'].strip()) > 0",
          "@value" : "{{r['skos:editorialNote']}}"
        },
        "skos:definition": [
          {
            "@if" : "'rdfs:comment' in r and r['rdfs:comment'] is not None and len(r['rdfs:comment'].strip()) > 0",
            "@value" : "{{r['rdfs:comment']}}"
          },
          {
            "@if" : "'skos:definition' in r and r['skos:definition'] is not None and len(r['skos:definition'].strip()) > 0",
            "@value" : "{{r['skos:definition']}}"
          }
        ],
        "rdfs:subClassOf": [
          { "@if" : "'hasneto:hasUnit' in r and not isempty(r['hasneto:hasUnit'])",
            "@type" : "owl:Restriction",
            "owl:onProperty" : { "@id":"sio:hasUnit"},
            "owl:hasValue" : { "@id": "{{r['hasneto:hasUnit']}}" }
          },
          {
            "@if" : "'rdfs:subClassOf' in r and r['rdfs:subClassOf'] is not None and len(r['rdfs:subClassOf'].strip()) > 0",
            "@for" : "s in re.split('\\\\s*[,&]\\\\s*', r['rdfs:subClassOf'])",
            "@do" : { "@id": "{{s}}", "@type": "owl:Class"}
          }
        ]
      }
    }]
}]''']
.


<chear.ttl> a pv:File;
    dcterms:format "text/turtle";
    prov:wasGeneratedBy [
      a setl:Load;
      prov:used <http://hadatac.org/ont/chear>, :base_graph ;
    ].